pipeline:
  name: test-uses
  enabled: true
  with:
    test.scripts.directory: $PIPELINER_HOME/tests/scripts
  jobs:
    - name: test-job
      steps:
        - name: create-local-extension-zip
          run: |
            mkdir -p TMP
            rm -Rf TMP/*
            echo "echo executing example package" > TMP/execute.sh
            cd TMP && zip -qr tmp.zip *
        - name: create-local-extension-zip-checksum
          run: sha256sum TMP/tmp.zip | awk '{print $1}' > $extension.package.checksum
        - name: test-local-extension-zip-1
          run: --uses file://TMP/tmp.zip
        - name: test-local-extension-zip-2
          run: --uses file://TMP/tmp.zip ${{ extension.package.checksum }}
        - name: test-local-extension-zip-3
          with:
            extension.package.path: file://TMP/tmp.zip
          run: --uses ${{ extension.package.path }} ${{ extension.package.checksum }}
        - name: test-local-extension-zip-4
          env:
            EXTENSION_PACKAGE: file://TMP/tmp.zip
          run: --uses $EXTENSION_PACKAGE
        - name: test-local-extension-zip-5
          run: |
            cp TMP/tmp.zip TMP/tmp.ZIP
            --uses file://TMP/tmp.ZIP
        - name: convert-zip-to-tar-gz
          run: ${{ test.scripts.directory }}/convert-zip-to-tar-gz.sh TMP/tmp.zip TMP/tmp.tar.gz
        - name: create-local-extension-tar-gz-checksum
          run: sha256sum TMP/tmp.tar.gz | awk '{print $1}' > $extension.package.checksum
        - name: test-local-extension-tar-gz-1
          run: --uses file://TMP/tmp.tar.gz
        - name: test-local-extension-tar-gz-2
          run: --uses file://TMP/tmp.tar.gz ${{ extension.package.checksum }}
        - name: test-local-extension-7
          with:
            extension.package.path: file://TMP/tmp.tar.gz
          run: --uses ${{ extension.package.path }} ${{ extension.package.checksum }}
        - name: test-local-extension-tar-gz-3
          env:
            EXTENSION_PACKAGE: file://TMP/tmp.tar.gz
          run: --uses $EXTENSION_PACKAGE
        - name: test-local-extension-tar-gz-5
          run: |
            cp TMP/tmp.tar.gz TMP/tmp.TAR.GZ
            --uses file://TMP/tmp.TAR.GZ
        - name: test-remote-package-tar-gz-4
          enabled: false
          # Example using package from HTTP server
          run: --uses http://<YOUR_SERVER>/tmp.zip
        - name: test-remote-package-2
          enabled: false
          # Example using package from HTTP server
          run: --uses http://<YOUR_SERVER>/tmp.zip 9911610f3f9774705744935ee19efcfdcb64f0d01d19a182fa92cc8fb3f34cf3
        - name: test-remote-package-3
          enabled: false
          # Example using package from HTTP server
          run: --uses http://<YOUR_SERVER/tmp.tar.gz
        - name: test-remote-package-4
          enabled: false
          # Example using package from HTTP server
          run: --uses http://<YOUR_SERVER/tmp.tar.gz 1d4941702fe44616613f1662724419b9818e57e062420b4afea48c25c2d87695
